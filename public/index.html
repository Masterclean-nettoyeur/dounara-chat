<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DouNara</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  background:#0b0014;
  color:#e0b3ff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100dvh;
  font-family:Arial;
}

.app {
  background:#12001f;
  width:100%;
  max-width:400px;
  height:100dvh;
  display:flex;
  flex-direction:column;
}

header {
  background:#24003d;
  padding:15px;
  text-align:center;
  font-size:22px;
}

#login, #chat {
  flex:1;
  display:flex;
  flex-direction:column;
  padding:10px;
}

#chat { display:none; }

#messages {
  flex:1;
  overflow-y:auto;
}

.message img {
  max-width:70%;
  border-radius:10px;
  margin-top:5px;
}

.footer {
  display:flex;
  gap:5px;
}

button {
  background:violet;
  border:none;
  border-radius:10px;
  padding:8px;
}
</style>
</head>

<body>
<div class="app">
<header>
  ðŸ’œ DouNara ðŸ’œ  
  <button onclick="goAlbum()">ðŸ“¸ Album</button>
</header>

<div id="login">
  <input id="name" placeholder="Ton nom">
  <button onclick="join()">Se connecter</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <div class="footer">
    <input type="file" id="imageInput" accept="image/*" onchange="sendImage()">
    <input id="msg" placeholder="Message...">
    <button onclick="send()">âž¤</button>
  </div>
</div>
</div>

<script>
const socket = io();
let album = [];

function join(){
  socket.emit("join", name.value);
}

socket.on("joined", ()=>{
  login.style.display="none";
  chat.style.display="flex";
});

socket.on("album", (imgs)=>{
  album = imgs;
  localStorage.setItem("album", JSON.stringify(album));
});

function send(){
  socket.emit("message", msg.value);
  addText("Moi: "+msg.value);
  msg.value="";
}

socket.on("message", (msg)=>{
  addText("Lui: "+msg);
});

function sendImage(){
  const file = imageInput.files[0];
  const reader = new FileReader();
  reader.onload = function(){
    socket.emit("image", reader.result);
    addImage(reader.result);
  };
  reader.readAsDataURL(file);
}

socket.on("image", (imgData)=>{
  addImage(imgData);
});

function addText(text){
  let d=document.createElement("div");
  d.textContent=text;
  messages.appendChild(d);
}

function addImage(data){
  let d=document.createElement("div");
  let img=document.createElement("img");
  img.src=data;
  d.appendChild(img);
  messages.appendChild(d);
}

function goAlbum(){
  window.location.href="gallery.html";
}
</script>
</body>
</html>
